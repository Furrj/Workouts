<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Workout</title>
  </head>
  <body>
    <form action="/add" aria-label="sets" id="sets" method="POST"></form>

    <button id="add_set_btn">Add Set</button>

    <script>
      let setCount = 0;
      const setMap = new Map();
      class Set {
        id;
        root;
        reps;

        constructor(id, root) {
          this.id = id;
          this.root = root;
          this.reps = [];
        }
      }

      // Form
      const form = document.getElementById("sets");
      form.onsubmit = (ev) => {
        ev.preventDefault();
        //form.submit();
      };

      const submitButton = document.createElement("button");
      submitButton.type = "submit";
      submitButton.id = "submit_btn";
      submitButton.innerText = "Submit";

      const addSetButton = document.getElementById("add_set_btn");
      addSetButton.addEventListener("click", () => {
        if (setCount === 0) {
          form.appendChild(submitButton);
        }

        // TEST
        addSet_TEST();
      });

      function addSet_TEST() {
        setCount++;

        const set = document.createElement("div");
        set.id = `set_${setCount}`;
        set.classList.add("set_root");

        const name_input = document.createElement("input");
        name_input.type = "text";
        name_input.classList.add("set_name");
        name_input.id = `set_${setCount}_name`;

        form.appendChild(set);
        set.appendChild(name_input);

        const newSet = new Set(setCount, set);
        setMap.set(`set_${setCount}`, newSet);
        console.log(setMap.get(`set_${setCount}`));

        addRepCont(setCount, 1);
      }

      function addRepCont(parentID, repID) {
        const rep_cont = document.createElement("div");
        rep_cont.classList.add("rep_cont");
        rep_cont.id = `set_${parentID}_rep_${repID}`;

        const parent = document.getElementById(`set_${parentID}`);
        parent.appendChild(rep_cont);

        const button = document.createElement("button");
        button.classList.add("add_rep_btn");
        button.innerText = "Add Rep";
        button.onclick = (ev) => {
          rep_cont.removeChild(button);
          rep_cont.innerText = "INPUT";
          addRepCont(parentID, repID + 1);
          console.log("TEST");
        };

        rep_cont.appendChild(button);
      }

      function addSet(id) {
        setCount++;

        // Root div
        const set = document.createElement("div");
        set.id = `set_${setCount}`;
        set.classList.add("set_root");

        // ID div (left)
        const id_cont = document.createElement("div");
        id_cont.classList.add("id_cont");
        id_cont.innerText = setCount.toString();

        // Set input
        const set_input = document.createElement("input");
        set_input.classList.add("set_input");
        set_input.type = "text";
        set_input.ariaLabel = `set_${setCount}_input`;
        set_input.name = `set_${setCount}_input`;
        set_input.id = `set_${setCount}_input`;
        set_input.onkeydown = (ev) => {
          if (ev.key === "Enter") {
            ev.preventDefault();
          }
        };

        console.log(`setCount: ${setCount}`);
        set.appendChild(id_cont);
        set.appendChild(set_input);
        form.appendChild(set);
      }
    </script>
  </body>
</html>

<style>
  * {
    box-sizing: border-box;
    color: black;
  }

  input {
    color: black;
  }

  button {
    cursor: pointer;
  }

  body {
    width: 100vw;
    height: 100vh;
    background: black;

    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  #add_set_btn {
    width: fit-content;
    height: 50px;

    font-size: xx-large;
    color: black;

    margin-top: 10px;
  }

  #submit_btn {
    order: 0;
    font-size: xx-large;
    cursor: pointer;
    color: black;
  }

  #sets {
    width: 80%;
    height: auto;

    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .set_root {
    width: 70%;
    min-height: 50px;

    background: white;

    border: 1px solid black;
    border-radius: 1rem;
    margin-top: 10px;

    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .set_name {
    width: 50%;

    text-align: center;
    font-size: large;

    margin: 0.5rem;

    order: -1;
  }

  .add_rep_btn {
    font-size: x-large;
  }

  .rep_cont {
    height: 75px;
    width: 100%;

    border-top: 1px solid black;

    display: flex;
    align-items: center;
    justify-content: center;
  }

  .id_cont {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;

    border-right: 1px solid black;
    border-top-left-radius: 1rem;
    border-bottom-left-radius: 1rem;
    font-size: xx-large;
    background: grey;
  }

  .set_input {
    width: 100%;
    font-size: xx-large;
    border: none;
    border-top-right-radius: inherit;
    border-bottom-right-radius: inherit;
    color: black;
  }
</style>
